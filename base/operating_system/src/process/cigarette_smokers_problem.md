# 吸烟者问题

假设一个系统有三个吸烟者进程和一个供应者进程。每个吸烟者不停地卷烟并抽掉它, 但是要卷起并抽掉一支烟, 吸烟者需要有三种材料: 烟草、纸和胶水。

三个吸烟者中, 第一个拥有烟草、第二个拥有纸、第三个拥有胶水。供应者进程无限地提供三种材料, 供应者每次将两种材料放桌子上, 拥有剩下那种材料的吸烟者卷一根烟并抽掉它, 并给供应者进程一个信号告诉完成了, 供应者就会放另外两种材料再桌上, 这个过程一直重复, 并让三个吸烟者轮流地抽烟。

```cpp
/*
组合一: 纸+胶水
组合二: 烟草+胶水
组合三: 烟草+纸

桌上有组合一 à 第一个吸烟者取走东西
桌上有组合二 à 第二个吸烟者取走东西
桌上有组合三 à 第三个吸烟者取走东西
发出完成信号 à 供应者将下一个组合放到桌上
*/
semaphore offer1 = 0; // 桌上组合一的数量
semaphore offer2 = 0; // 桌上组合二的数量
semaphore offer3 = 0; // 桌上组合三的数量
semaphore finish = 1; // 吸烟是否完成

// 供应者
void producer() {
    int i = 0;
    while (1) {
        // 等待吸烟完成
        V(finish);
        // 提供材料
        if (i == 0) {
            // 组合一
            P(offer1);
        } else if (i == 1) {
            // 组合二
            P(offer2);
        } else if (i == 2) {
            // 组合三
            P(offer3);
        }
        // 更新索引
        i = (i + 1) % 3;
    }
}

// 吸烟者1
void smoker1() {
    // 等待组合一
    P(offer1);
    // 吸烟完成
    V(offer1);
}

// 吸烟者2
void smoker2() {
    // 等待组合二
    P(offer2);
    // 吸烟完成
    V(offer2);
}

// 吸烟者2
void smoker2() {
    // 等待组合三
    P(offer3);
    // 吸烟完成
    V(offer3);
}
```
