# 内存

程序执行前需要先放到内存中才能被 CPU 处理。

内存地址从 0 开始, 每个地址对应一个存储单元。如果计算机按字节编址, 则每个存储单元大小为 1 字节。如果字长为 16 位的计算机按字编址, 则每个存储单元大小为 1 个字(2 字节)。

## 把程序装入内存的三种方式

### 绝对装入方式（Absolute Loading）

直接装入方式是最简单的一种装入方式。在这种方式中, 程序在编译时就已经确定了其在内存中的绝对地址。装入程序时, 操作系统直接将程序从辅存（如硬盘）读入到内存中预先确定的地址处。

这种方式要求程序在编译时就知道其在内存中的位置, 因此缺乏灵活性, 不适用于多道程序环境。

### 静态重定位装入方式（Relocatable Loading）

可重定位装入方式解决了直接装入方式中地址固定的问题。程序在编译后使用的地址都是相对于起始地址而言的逻辑地址。在装入程序时, 操作系统可以根据内存的当前情况, 将程序装入到内存的任意位置。装入过程中, 程序的地址部分会被修改, 以反映其在内存中的实际位置。这种方式增加了程序装入的灵活性, 允许多个程序同时驻留在内存中。

静态重定位的特点是在一个程序装入内存时, 必须分配其要求的全部内存空间, 如果没有足够的内存, 就不能装入该程序。 程序一旦进入内存后, 在运行期间就不能再移动, 也不能再申请内存空间。

### 动态重定位装入方式（Dynamic Loading）

动态运行时装入方式是一种更为灵活的装入方法。它不是在程序开始运行前将整个程序装入内存, 而是根据程序的运行需要, 动态地装入相应的模块。这种方式可以更高效地利用内存资源, 因为它只装入程序当前需要的部分。当需要执行某段代码时, 如果它不在内存中, 操作系统才会将其装入。

在现代操作系统中, 动态运行时装入方式得到了广泛应用, 因为它能更有效地管理内存资源, 提高系统效率。

## 链接的三种方式

链接（Linking）是编译过程的一个阶段, 它将一个或多个编译后的目标文件（object file）合并成一个可执行文件。

### 静态链接（Static Linking）

静态链接是在程序编译和链接时完成的。在这个过程中, 链接器将所有的目标模块和库文件合并成一个完整的可执行文件。这个可执行文件包含了程序运行所需的所有代码和数据, 因此可以在没有其他依赖的情况下独立运行。

静态链接的优点是执行速度快, 因为不需要在运行时进行动态加载。缺点是生成的可执行文件体积较大, 且更新库时需要重新编译和链接。

### 动态链接（Dynamic Linking）

动态链接是在程序运行时进行的。在编译时, 并不将所有的库函数和数据合并到可执行文件中, 而是仅包含对库的引用。当程序运行时, 操作系统负责将所需的库加载到内存中, 并与可执行文件链接起来。

动态链接的优点是可以节省内存和磁盘空间, 因为共享库可以被多个程序共享, 同时, 更新库时不需要重新编译程序。缺点是可能会有一定的性能开销, 因为需要在运行时进行链接。

### 延迟链接（Lazy Linking）

延迟链接是动态链接的一种特殊形式。在延迟链接中, 只有在程序实际调用某个函数或访问某个变量时, 才会进行链接和加载相应的库。这种方式可以进一步减少程序的启动时间, 因为它避免了在程序启动时加载所有可能用到的库。延迟链接通常与动态链接一起使用, 以优化程序的加载和运行效率。
