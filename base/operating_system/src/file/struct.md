# 文件的逻辑结构

- 无结构文件：文件内部的数据就是一系列二进制流或字符流组成。又称为流式文件。如 .txt 文件。
- 有结构文件：由一组相似的记录组成, 又称为记录式文件。每条记录又若干个数据项组成。如数据库表文件。一般来说, 每条记录有一个数据项可作为关键字。根据各条记录的长度(占用的存储空间)是否相等, 又可分为定长记录和可变长记录两种

## 有结构文件

根据有结构文件中的各条记录在逻辑上如何组织, 可以分为三类

- 顺序文件
- 索引文件
- 索引顺序文件

## 顺序文件

顺序文件：文件中的记录一个接一个地顺序排列(逻辑上), 记录可以是定长的或可变长的。各个记录在物理上可以顺序存储或链式存储。

- 顺序存储: 逻辑上相邻的记录物理上也相邻(类似于顺序表)
  - 可变长记录: 需要维护每条记录的长度, 无法实现随机存取。每次只能从第一个记录开始依次往后查找
  - 定长记录: 可实现随机存取。记录长度为 L, 则第 i 个记录存放的相对位置是 `i * L`
- 链式存储: 逻辑上相邻的记录物理上不一定相邻(类似于链表)。无论是定长还是变长记录, 都无法实现随机存取, 每次只能从第一个记录开始依次往后查找

使用定长记录的顺序存储可以继续分为:

- 串结构: 记录之间的顺序与关键字无关, 若采用串结构, 则无法快速找到某关键字对应的记录
- 顺序结构: 记录之间的顺序按关键字顺序排列, 若采用顺序结构, 可以快速找到某关键字对应的记录(如折半查找)

一般来说, 考试题目中所说的"顺序文件"指的是物理上顺序存储的顺序文件

## 索引文件

对于可变长记录文件, 要找到第 i 个记录, 必须先顺序第查找前 i-1 个记录, 但是很多应用场景中又必须使用可变长记录。为了解决这个问题, 可以使用索引文件。

为文件建立一张索引表以加快文件检索速度。每条记录对应一个索引项。文件中的这些记录在物理上可以离散地存放。

索引表本身是定长记录的顺序文件。因此可以快速找到第 i 个记录对应的索引项。可将关键字作为索引号内容, 若按关键字顺序排列, 则还可以支持按照关键字折半查找。

每当要增加/删除一个记录时, 需要对索引表进行修改。由于索引文件有很快的检索速度, 因此主要用于对信息处理的及时性要求比较高的场合。

另外, 可以用不同的数据项建立多个索引表。如：学生信息表中, 可用关键字“学号”建立一张索引表。也可用“姓名”建立一张索引表。这样就可以根据“姓名”快速地检索文件了。

## 索引顺序文件

索引文件的每个记录对应一个索引表项, 因此索引表可能会很大。为了解决这个问题, 可以使用索引顺序文件。

索引顺序文件是索引文件和顺序文件思想的结合。索引顺序文件中, 同样会为文件建立一张索引表, 但不同的是, 并不是每个记录对应一个索引表项, 而是一组记录对应一个索引表项。比如, 学生记录按照学生姓名的开头字母进行分组。每个分组是一个顺序存储的顺序文件, 组中的项并不需要记录到索引表中。

若一个顺序文件(不是定长记录、顺序结构的顺序文件)有 10000 个记录, 则根据关键字检索文件, 只能从头开始顺序查找, 平均须查找 5000 个记录。

若采用索引顺序文件结构, 可把 10000 个记录分为 √10000 = 100 组, 每组 100 个记录。则需要先顺序查找索引表找到分组(共 100 个分组, 因此索引表长度为 100, 平均需要查 50 次), 找到分组后, 再在分组中顺序查找记录(每个分组 100 个记录, 因此平均需要查 50 次)。采用索引顺序文件结构后, 平均查找次数减少为 50+50 = 100 次。

## 多级索引顺序文件

为了进一步提高检索效率, 可以为顺序文件建立多级索引表。例如, 对于一个含 10^6 个记录的文件, 可先为该文件建立一张低级索引表, 每 100 个记录为一组, 故低级索引表中共有 10000 个表项(即 10000 个定长记录), 再把这 10000 个低级索引表分组, 每组 100 个, 为其建立顶级索引表, 故顶级索引表中共有 100 个表项。此时, 检索一个记录平均需要查找 50+50+50 = 150 次。
