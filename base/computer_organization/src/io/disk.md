# 硬磁盘存储器

结构:

- 碟片
- 磁盘驱动器: 包括主轴、定位驱动和数据控制器三部分，作用是接收由主机发来的命令，将它换成磁盘驱动器的控制命令，实现主机和驱动器之间的数据格式转换和数据传送，并控制驱动器的读/写

## 硬磁盘轨道记录格式:

### 磁头数

在硬盘内部，通常有多张盘片（Platter）堆叠在一起，每张盘片的上下两面都可以存储数据，而每一个存储面都对应着一个磁头。

磁头数就是指硬盘中用于读写数据的磁头的数量。早期的硬盘盘片数量较多，磁头数也相应较多；而现在的硬盘则通过提高单盘片的存储容量，减少了盘片数量和磁头数，同时也降低了硬盘的功耗和体积。

记录面指的是存储设备上可用于记录数据的表面，而记录面数就是可用于记录数据的表面的数量。

磁头数等于记录面数。

### 柱面数

硬盘通常由多个盘片堆叠在一起，每个盘片的上下两面都可以存储数据，每个盘片表面又被划分成许多同心圆，这些同心圆就称为磁道（Track）。当把所有盘片上相同半径的磁道组合在一起时，就形成了一个柱面（Cylinder）。例如，硬盘有 3 个盘片，每个盘片有上下两个面，总共 6 个记录面。每个记录面上都有一系列的磁道，当我们选取所有记录面上半径相同的磁道时，这些磁道就构成了一个柱面。

柱面数: 表示硬盘每一面盘面上有多少磁道。

### 扇区数

在硬盘的盘片上，每个磁道会被进一步划分成若干个弧段，这些弧段就被称为扇区（Sector）。扇区是硬盘进行数据存储和读写操作的最小物理单位。

扇区数: 表示每一条磁道上有多少个扇区

## 磁记录原理

磁记录的基本原理基于磁性材料的两个重要特性：剩磁性和磁电转换。

- 剩磁性：某些磁性材料（如铁氧体、金属磁粉等）在外部磁场的作用下会被磁化，当外部磁场消失后，这些材料仍能保留一定程度的磁性，即剩磁。剩磁的方向取决于外部磁场的方向，利用这一特性可以将信息以剩磁的形式存储在磁性材料中
- 磁电转换：当磁头靠近具有剩磁的磁性材料时，磁头中的线圈会因磁通量的变化而产生感应电动势，反之，当给磁头的线圈通入电流时，会在线圈周围产生磁场，从而可以对磁性材料进行磁化。这种磁与电之间的相互转换是实现磁记录读写操作的基础

磁记录的记录过程也就是将数据信息转换为磁性材料上剩磁状态的过程，具体步骤如下：

1. 数据编码：计算机中的二进制数据（0 和 1）首先需要经过编码处理，转换为适合磁记录的信号形式。常见的编码方式有不归零制（NRZ）、调频制（FM）、改进调频制（MFM）等
2. 产生磁场：经过编码的数据被送到硬盘的磁头驱动器，驱动器根据数据的不同状态（如 0 或 1）向磁头的线圈通入不同方向或大小的电流，从而在线圈周围产生相应的磁场
3. 磁化介质：硬盘的盘片表面涂有一层磁性材料，当磁头靠近盘片表面并相对运动时，磁头产生的磁场会使盘片上的磁性材料被磁化。根据通入电流的方向不同，磁性材料被磁化后的剩磁方向也不同，这样就将二进制数据以剩磁的形式记录在了盘片上。例如，规定剩磁方向为正表示 1，剩磁方向为负表示 0

磁记录的读取过程是将磁性材料上的剩磁状态转换为电信号并还原为原始数据的过程，具体步骤如下：

1. 感应电动势：当磁头经过盘片上已经记录有剩磁的区域时，磁头中的线圈会感受到磁通量的变化，根据电磁感应定律，线圈中会产生感应电动势。感应电动势的大小和方向取决于磁通量变化的速率和剩磁的方向
2. 信号放大与处理：磁头感应产生的电动势非常微弱，需要经过放大器进行放大处理。放大后的信号还需要经过滤波、整形等处理，以去除噪声和干扰，得到清晰的电信号
3. 数据解码：经过处理后的电信号被送到解码器，解码器根据记录时采用的编码方式将电信号还原为原始的二进制数据。例如，如果记录时采用的是不归零制编码，解码器会根据电信号的极性判断是 0 还是 1

## .磁盘地址

```
[驱动器号 | 柱面号 | 盘面号 | 扇区号]
```

## 磁盘阵列(RAID)

RAID，是将多个独立的物理磁盘组成一个独立的逻辑盘，数据在多个物理盘上交叉存储、并行访问，存储性能、可靠性和安全性都较高。
RAID 有 6 个分级，其中 RAID1~RAID5 无论何时有磁盘损坏，都可以随时拔出损坏的磁盘再插入好的磁盘，而数据不会丢失。

- RAIDO: 无冗余，无校验的磁盘阵列
- RAID1: 镜像磁盘阵列
- RAID2: 含有可纠错的海明码校验
- RAID3: 采用位交叉奇偶校验
- RAID4: 采用块交叉奇偶校验
- RAID5: 无独立校验的奇偶校验磁盘阵列

## 磁盘访问时间

- 寻道时间: 把磁头移动到指定磁道上所经历的时间
- 旋转延迟时间: 扇区移动到磁头下面所经历的时间。通常我们用磁盘旋转一周时间的一半来估计。
- 传输时间: 把数据从磁盘读出或向磁盘写入数据所经历的时间

## 磁盘调度

- 先先服务(FCFS): 按照进程请求访问磁盘的先后顺序依次处理请求。即先到达的请求先被服务，后到达的请求依次排队等待
- 最短寻道时间优先(SSTF): 优先处理距离当前磁头位置最近的请求，使得每次寻道的时间最短
- 扫描(SCAN)算法: 磁头在一个方向（如从磁盘的最内侧向最外侧）上移动，依次处理经过的请求，直到到达磁盘的边缘，然后改变移动方向，继续处理反方向上的请求。类似于电梯的运行方式，所以也叫电梯算法
- 循环扫描(CSCAN)算法: 磁头总是沿着一个方向（如从磁盘的最内侧向最外侧）移动，依次处理经过的请求，当到达磁盘边缘后，磁头立即返回到磁盘的另一侧起始位置，继续向原来的方向移动并处理请求。与 SCAN 算法不同的是，它不会在返回时处理请求
- LOOK 算法: 与 SCAN 算法类似，但磁头只移动到最远端的请求位置，而不需要移动到磁盘的物理边缘。当磁头移动到最远端请求位置后，就改变移动方向

磁盘驱动器有 5000 个柱面，从 0 到 4999，当前磁头在柱面 143 上处理，前一个处理位置为柱面 125。按 FIFO 顺序，将要处理的请求队列是: 86,1470,913,1774,948,1509,1022,1750,130。从当前磁头位置开始，按照下面的磁盘调度算法，要满足队列中即将到来的请求要求磁头总的移动距离(按柱面数计)是多少？

(1) FCFS

(2) SSTF

(3) SCAN

(4) LOOK

(5) C-SCAN
