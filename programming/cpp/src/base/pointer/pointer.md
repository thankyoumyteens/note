# 指针

声明一个指针:

```cpp
int *p = nullptr;
```

int 类型后面的 `*` 表示，所声明的变量引用/指向某个整数内存。`nullptr` 在 C++11 中引入, 表示空指针, 空指针是一个特殊的默认值，有效的指针都不含该值，在布尔表达式中使用时会被转换为 false:

```cpp
if (!p) {
    std::cout << "指针为空" << std::endl;
}
```

使用 `new` 操作符在堆中分配内存:

```cpp
p = new int;
```

在此情况下，指针只是指向一个整数值的地址。为访问这个值，需要对指针解除引用。可将解除引用看成沿着指针箭头的方向寻找堆中实际的值:

```cpp
*p = 10;
```

使用完动态分配的内存后，需要使用 `delete` 操作符释放内存。为防止在释放指针指向的内存后再使用指针，建议把指针设置为 `nullptr`:

```cpp
delete p;
p = nullptr;
```

## 指向栈中的变量

指针并非总是指向堆内存，可声明一个指向栈中变量甚至指向其他指针的指针。为让指针指向某个变量，需要使用 取址 运算符 `&`:

```cpp
int a = 10;
int *p = &a;
```

## 指向结构体

C++使用特殊语法来处理指向结构体的指针。

如果指针指向某个结构体，可以首先用 `*` 解除引用，然后使用普通的 `.` 语法访问结构体中的字段:

```cpp
DemoStruct *p = getStruct();

std::string val = (*p).name;
```

由于上面的语法写起来复杂, 可以使用 `->` 箭头运算符同时对指针解除引用并访问字段:

```cpp
DemoStruct *p = getStruct();

std::string val = p->name;
```

## 指向数组

堆也可以用于动态分配数组。使用 `new[]` 操作符可给数组分配内存:

```cpp
int arrayLength = 10;
// 可以使用变量来分配数组长度
int *p = new int[arrayLength];
```

可将 p 当作普通数组使用:

```cpp
p[1] = 10;
```

使用完这个数组后, 通过 `delete[]` 操作符将其从堆中删除:

```cpp
delete[] p;
p = nullptr;
```
