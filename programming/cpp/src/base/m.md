# 内存模型

内存分为内核空间和用户空间, 内核空间由操作系统管理, C++程序运行在用户空间。

用户空间分为:

- 栈: 存放程序中的局部变量, 函数参数和返回值。栈的数据是由编译器自己分配和释放的, 超出作用域后, 栈会自动释放。栈的大小一般只有 8MB
- 内存映射区段：例如将动态库, 共享内存等虚拟空间的内存映射到物理空间的内存, 一般是 mmap 函数所分配的虚拟内存空间
- 堆: 存放程序中动态分配内存的变量(malloc、free、new、delete 等)。需要手动释放, 如果没有释放则会一直存在到程序运行结束。堆的大小取决于物理内存大小
- BSS 段: 存放未初始化的静态变量、全局变量，但是不会存放常量(因为常量在定义的时候就一定会赋值)。对于未初始化的全局变量和静态变量，编译器在编译阶段都会将其默认为 0
- 数据段: 存放编译阶段就能确定的数据，也就是已经初始化的静态变量、全局变量和常量
- 代码段: 存放程序的代码，但是不是按照代码文本的形式存放，而是将代码编译成二进制代码，存放的是二进制代码。在编译时就已经确定这个区域存放的内容是什么了，并且这个区域是只读区域

![](../../img/m.jpg)
