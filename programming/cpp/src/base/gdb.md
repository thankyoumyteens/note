# gdb 调试

编译带调试信息的程序: 调试前必须用 g++ 编译程序时添加 -g 选项（生成调试信息，否则 gdb 无法识别代码结构）

```sh
# 编译 main.cpp 生成可执行文件 main，同时加入调试信息
g++ -g main.cpp -o main
```

### 启动 gdb 并加载程序

```sh
gdb ./main
```

### 核心调试命令

| 调试需求               | gdb 命令                          | 说明                                                                                 |
| ---------------------- | --------------------------------- | ------------------------------------------------------------------------------------ |
| 设置命令行参数         | `set args 参数1 参数2 ...`        | 例：`set args -A -B -C`                                                              |
| 设置断点（按行号）     | `break 行号` 或 `b 行号`          | 例：`b 10` 在第 10 行设置断点，程序运行到此处会暂停。                                |
| 设置断点（按函数名）   | `break 函数名` 或 `b 函数名`      | 例：`b add` 在 `add` 函数的入口处设置断点。                                          |
| 查看所有断点           | `info breakpoints` 或 `info b`    | 显示已设置的断点列表（含断点编号、位置、状态）。                                     |
| 删除断点               | `delete 断点编号` 或 `d 断点编号` | 例：`d 1` 删除编号为 1 的断点（编号通过 `info b` 查看）。                            |
| 运行程序               | `run` 或 `r`                      | 启动程序，直到遇到断点或程序结束。                                                   |
| 单步执行（不进入函数） | `next` 或 `n`                     | 执行当前行代码，若当前行是函数调用，直接执行完函数并跳到下一行。                     |
| 单步执行（进入函数）   | `step` 或 `s`                     | 执行当前行代码，若当前行是函数调用，进入函数内部并停在函数第一行。                   |
| 继续执行到下一个断点   | `continue` 或 `c`                 | 从当前暂停位置继续运行，直到遇到下一个断点或程序结束。                               |
| 查看变量值             | `print 变量名` 或 `p 变量名`      | 例：`p a` 显示变量 `a` 的当前值；支持表达式，如 `p a + b`, 会输出 a+b 运算后的结果。 |
| 修改变量值             | `set var 变量名=值`               | 例：`set var name="张三"` 把变量 `name` 的当前值改为"张三"。                         |
| 查看函数调用栈         | `backtrace` 或 `bt`               | 显示当前程序的调用栈（即“谁调用了谁”），常用于定位崩溃位置。                         |
| 退出 gdb               | `quit` 或 `q`                     | 退出 gdb 调试环境，回到终端。                                                        |

## 调试正在运行的程序

### 步骤 1：获取目标进程的 PID

首先需要知道正在运行的程序的进程 ID（PID），可通过以下命令查询：

```sh
# 方法 1：通过程序名查询
ps -ef | grep 程序名

# 方法 2：更简洁的方式（只显示 PID 和程序名）
pgrep 程序名
```

### 步骤 2：用 gdb 附加到目标进程

```sh
# 格式：gdb 程序路径 进程PID
gdb ./main 12345
```

若不知道程序路径，也可直接用 `gdb -p 12345`（自动查找程序路径）。

### 步骤 3：执行调试操作

与普通调试一致

### 步骤 4：调试结束后分离进程

试完成后，若希望目标进程继续运行（不终止），需用 detach 命令分离 gdb 与进程

```sh
(gdb) detach  # 分离进程，进程继续运行
(gdb) quit    # 退出 gdb
```

若需终止进程，直接用 kill 命令

```sh
(gdb) kill    # 终止被调试的进程
(gdb) quit    # 退出 gdb
```
