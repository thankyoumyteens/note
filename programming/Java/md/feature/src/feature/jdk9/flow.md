# 响应式流

ava 9 正式引入了响应式流（Reactive Streams） 规范，作为 JDK 的一部分（位于 java.util.concurrent 包下），旨在定义一套标准的异步流处理 API，解决异步数据传输中的背压（Backpressure） 问题，实现数据生产者和消费者之间的流量平衡。

在传统的异步数据处理中，若生产者发送数据的速度远快于消费者处理速度，可能导致以下问题：

- 消费者缓冲区溢出，导致内存耗尽或数据丢失。
- 生产者与消费者之间没有标准化的协作机制，需要手动设计流量控制逻辑。

响应式流的核心是通过背压机制解决这一问题：消费者可以根据自身处理能力，主动向生产者反馈 “能接收多少数据”，生产者根据反馈调整发送速度，实现供需平衡。

Java 9 的 java.util.concurrent.Flow 接口包含 4 个核心嵌套接口，对应响应式流规范的四大角色：

| 接口                | 角色     | 作用                                                                   |
| ------------------- | -------- | ---------------------------------------------------------------------- |
| `Flow.Publisher`    | 生产者   | 发布数据，响应消费者的订阅和背压请求。                                 |
| `Flow.Subscriber`   | 消费者   | 接收并处理数据，向生产者反馈处理能力（背压信号）。                     |
| `Flow.Subscription` | 订阅关系 | 连接生产者和消费者，负责传递背压信号（如请求数据、取消订阅）。         |
| `Flow.Processor`    | 处理器   | 既是消费者（接收上游数据）又是生产者（向下游发送数据），用于数据转换。 |

接口关系与协作流程：

1. 消费者通过 Publisher.subscribe(Subscriber) 订阅生产者
2. 生产者创建 Subscription 并通过 Subscriber.onSubscribe(Subscription) 反馈给消费者
3. 消费者通过 Subscription.request(n) 向生产者请求 n 个数据（背压信号：“我能处理 n 个数据”）
4. 生产者通过 Subscriber.onNext(T) 向消费者发送数据（不超过请求的 n 个）
5. 数据处理完成 / 出错 / 终止时，生产者调用 Subscriber.onComplete()/onError(Throwable)
