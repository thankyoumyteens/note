# 异常处理指令

在 Java 程序中显式抛出异常的操作(throw 语句)都由 athrow 指令来实现, 除了用 throw 语句显式抛出异常的情况之外, JVM 会在其他字节码指令检测到异常状况时自动抛出。例如当除数为零时, 会在 idiv 或 ldiv 指令中抛出 ArithmeticException 异常。

而在 JVM 中, 处理异常(catch 语句)不是由字节码指令来实现的, 而是通过 Code 属性表中的显式异常处理表来完成。

## athrow

抛出一个异常实例(exception 或者 error)

```
操作码:
        athrow
操作数:
        -
操作数栈-执行前:
        objectref
操作数栈-执行后:
        objectref
```

objectref 必须为一个 reference 类型的数据, 它指向一个 Throwable 或其子类的对象实例。在指令执行时, objectref 首先从操作数栈中出栈, 然后搜索当前方法中与 objectref 的类型相匹配的第一个异常处理器。

如果找到了适合 objectref 的异常处理器, 这个异常处理器将包含一个用于处理此异常的代码位置。程序计数器的值就会被重设为异常处理器指定的那个位置上, 整个当前栈帧的操作数栈都会被清空, objectref 重新压入到操作数栈中, 然后程序继续执行。

如果在当前栈帧中没有找到适合的异常处理器, 那么栈帧就要从操作数栈中出栈, 这个栈帧的调用者被恢复。如果调用者栈帧仍然没有找到合适的异常处理器, 那它也会继续退出, objectref 也会不断重新抛出, 假设已经没有任何的栈帧可以退出, 那当前线程将被结束掉。
