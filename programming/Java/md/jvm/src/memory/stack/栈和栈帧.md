# 栈和栈帧

Java虚拟机栈(Java Virtual Machine Stack)也是线程私有的，它的生命周期与线程相同。

每个方法被执行的时候，Java虚拟机都会同步创建一个栈帧(Stack Frame)用于存储局部变量表、操作数栈、动态连接、方法出口等信息。每一个方法被调用直至执行完毕的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。

在《Java虚拟机规范》中，对这个内存区域规定了两类异常状况：

1. 如果Java虚拟机栈容量设为固定大小，当线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常。
2. 如果Java虚拟机栈容量可以动态扩展，当栈扩展时无法申请到足够的内存会抛出OutOfMemoryError异常。

对于执行引擎来讲，在活动线程中，只有位于栈顶的方法才是在运行的，只有位于栈顶的栈帧才是生效的，其被称为当前栈帧(Current Stack Frame)，与这个栈帧所关联的方法被称为当前方法(Current Method)。执行引擎所运行的所有字节码指令都只针对当前栈帧进行操作。

---

```java
public void methodB() {
    int b = 20;
    int c = 30;
}
public void methodA() {
    int a = 10;
    methodB();
}
```

上面代码运行时栈的变化如下：

![](./img/stack_change.png)
