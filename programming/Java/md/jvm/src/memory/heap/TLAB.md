# TLAB

堆是线程的共享区域, 任何线程都可以访问到堆中的数据, 由于对象的创建在 JVM 中非常频繁, 因此在并发环境下从堆中划分内存空间是线程不安全的。为了避免多个线程操作同一个地址, 需要使用线程同步机制(加锁等), 而同步会影响分配速度。

线程本地分配缓冲区(Thread Local Allocation Buffer, TLAB)是每个线程在 Eden 空间中私有的一块内存区域。开启 TLAB 时, JVM 会优先在 TLAB 中分配内存, 当对象在 TLAB 空间分配内存失败时, JVM 才会尝试通过使用同步机制在 Eden 空间中分配内存。

当一个 Java 线程在自己的 TLAB 中分配满了之后, 就会交出这个 TLAB 的所有权, 这块空间又会变回所有线程共享的 Eden 空间的一部分, 然后这个线程重新从 Eden 里申请一块新的空间作为新的 TLAB, 如果线程无法成功从 Eden 申请到空间, 就会至少触发一次 Young GC 来清理 Eden, 然后再重新尝试申请 TLAB。在垃圾回收的时候, 垃圾回收器不会特殊处理 TLAB, 而是把 Eden 空间当作一个整体来回收里面的对象。在垃圾回收结束之后, 每个 Java 线程又会重新从 Eden 中分配自己的 TLAB, 周而复始。
