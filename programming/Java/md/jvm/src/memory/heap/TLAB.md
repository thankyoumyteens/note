# TLAB

堆区是线程共享区域，任何线程都可以访问到堆区的共享数据，由于对象实例的创建在 JVM 中非常频繁，因此在并发环境下从堆区中划分内存空间是线程不安全的。为了避免多个线程操作同一地址，需要使用线程同步机制(加锁等)，而同步会影响分配速度。

线程本地分配缓冲区(Thread Local Allocation Buffer，TLAB)是 Java 虚拟机在运行时为每个线程在 Eden 空间中分配的一块内存区域，用于存储线程私有的对象实例。开启 TLAB 时，JVM 优先在 TLAB 中分配内存，当对象在 TLAB 空间分配内存失败时，JVM 会尝试通过使用同步机制确保数据操作的原子性，从而直接在 Eden 空间中分配内存。

当一个 Java 线程在自己的 TLAB 中分配到尽头之后，就会交出这个 TLAB 的所有权，这块空间又会变回所有线程共享的 Eden 空间的一部分，然后这个线程重新从 Eden 里分配一块空间作为新的 TLAB，如果线程无法成功从 Eden 分配到空间，就会至少触发 Minor GC 来清理 Eden，然后再重新尝试申请。在垃圾回收的时候，垃圾收集器不会特殊处理 TLAB，而是把 Eden 空间当作一个整体来收集里面的对象。在垃圾回收结束之后，每个 Java 线程又会重新从 Eden 分配自己的 TLAB，周而复始。
