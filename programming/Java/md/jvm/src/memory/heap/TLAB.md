# TLAB

堆区是线程共享区域，任何线程都可以访问到堆区的共享数据，由于对象实例的创建在JVM中非常频繁，因此在并发环境下从堆区中划分内存空间是线程不安全的。为了避免多个线程操作同一地址，需要使用加锁等机制，而加锁会影响分配速度。

线程本地分配缓冲区(Thread Local Allocation Buffer，TLAB)是Java虚拟机在运行时为每个线程在Eden空间中分配的一块内存区域，用于存储线程私有的对象实例。开启TLAB时，JVM优先在TLAB中分配内存，当对象在TLAB空间分配内存失败时，JVM会尝试通过使用加锁机制确保数据操作的原子性，从而直接在Eden空间中分配内存。

当一个Java线程在自己的TLAB中分配到尽头之后，就会交出这个TLAB的所有权，这块空间又会变回所有线程共享的Eden空间的一部分，然后这个线程重新从Eden里分配一块空间作为新的TLAB，如果线程无法成功从Eden分配到空间，就会至少触发Minor GC来清理Eden，然后再重新尝试申请。在垃圾回收的时候，垃圾收集器不会特殊处理TLAB，而是把Eden空间当作一个整体来收集里面的对象。在垃圾回收结束之后，每个Java线程又会重新从Eden分配自己的TLAB，周而复始。
