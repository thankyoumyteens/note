# 栈帧

一个方法从调用开始到执行完成，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。

# 栈帧的组成

1. 局部变量表
2. 操作数栈（或表达式栈）
3. 动态链接（或指向运行时常量池的方法引用）
4. 方法返回地址（或方法正常退出或者异常退出的定义）
5. 一些额外的附加信息

# 局部变量表

局部变量表(Local Variables)：是一个数字数组，主要用于存储方法参数和定义在方法体内的局部变量，这些数据类型包括各类基本数据类型、对象引用，以及returnAddress类型。局部变量表是线程私有的。

局部变量表所需的容量大小是在编译期确定下来的，并保存在字节码中。方法运行期间不会改变局部变量表的大小。

局部变量表中的变量只在当前方法调用中有效，当方法调用结束后，随着方法栈帧的销毁，局部变量表也会随之销毁。


```java
public class Main {
    public static void main(String[] args) {
        int a = 10;
        int b = 20;
        int c = a + b;
    }
}
```

上面代码编译后的字节码使用`javap -verbose Main.class`命令解析后如下：

![](./img/local_var_1.png)

## 变量槽(Slot)

局部变量表最基本的存储单元是槽(Slot)，局部变量表中存放编译期可知的各种基本数据类型(8种)，引用类型，returnAddress类型的变量。32位以内的类型占用一个slot(包括returnAddress类型)，64位的类型(long和double)占用两个slot。

JVM会为局部变量表中的每一个Slot都分配一个访问索引，通过这个索引即可成功访问到局部变量表中指定的局部变量值。


