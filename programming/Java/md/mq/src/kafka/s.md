# 保证消息的顺序

kafka 的特性是只支持单 partition 有序, 消息无法做到全局有序。如果将消息保存在同一个 topic 的同一个 partition 下, 虽然可以实现有序, 但性能会大幅降低。

解决方法: 使用 key+offset 实现业务级别有序。比如把订单编号作为 key, 不同的流程设置不同的 offset。消息取出后, 对于同一个 key 的消息，可以按照偏移量从小到大的顺序进行处理(比如暂存到 elasticsearch 中)。这种方法的问题是不一定每种业务都能适用。

总结: 与其用 kafka 实现消息有序, 不如换别的 mq。
