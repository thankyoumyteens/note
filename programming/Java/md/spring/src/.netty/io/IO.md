# IO

用户程序进行IO的读写，依赖于操作系统的read和write系统调用，read系统调用，并不是直接从物理设备把数据读取到内存中，而是把数据从内核缓冲区复制到进程缓冲区。write系统调用，也不是直接把数据写入到物理设备，而是把数据从进程缓冲区复制到内核缓冲区。read和write系统调用，都不负责数据在内核缓冲区和物理设备之间的交换，这些底层的读写交换是由操作系统内核来完成的。

外部设备的直接读写，涉及操作系统的中断。发生系统中断时，需要保存之前的进程数据和状态等信息，而结束中断之后，还需要恢复之前的进程数据和状态等信息。为了减少这种底层系统的时间损耗、性能损耗，于是出现了内存缓冲区。

应用程序使用write系统调用时，仅仅把数据从进程缓冲区复制到内核缓冲区中。底层操作会对内核缓冲区进行监控，等待缓冲区达到一定数量的时候，再进行IO设备的中断处理，集中执行物理设备的实际IO操作，这种机制提升了系统的性能。至于什么时候中断由操作系统来决定。

Java应用程序完成一次socket请求和响应的流程：

1. 等待数据从网络中到达网卡。当所等待的分组到达时，它被复制到内核中的某个缓冲区，这个工作由操作系统自动完成
2. Java程序通过read系统调用，将操作系统内核缓冲区的数据送入Java进程缓冲区
3. Java程序处理数据，并生成响应数据
4. Java程序通过write系统调用，将Java进程缓冲区的响应数据写入内核缓冲区
5. 操作系统把数据从内核缓冲区写到网卡，网卡通过底层的通信协议把数据发送到网络中
