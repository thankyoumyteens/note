# 自动装配

自动装配是它允许应用程序上下文自动找出并注入 bean 的依赖项。

spring 中实现自动装配的方式有:

1. 通过 xml 文件
2. 通过注解

## 手动装配

bean:

```java
public class User{
    private Role role;
}
public class Role {}
```

xml 配置文件:

```xml
<bean id="role1" class="demo.Role" />
<bean id="user1" class="demo.User">
    <!-- 通过setter注入 -->
    <property name="role" ref="role1" />
</bean>
```

## 通过 xml 文件自动装配

通过 xml 文件自动装配有 4 种自动装配策略:

1. byName: 把与 Bean 的字段具有相同名字的其他 Bean 自动装配到 Bean 的对应字段中
2. byType: 把与 Bean 的字段具有相同类型的其他 Bean 自动装配到 Bean 的对应字段中
3. constructor: 把与 Bean 的构造方法入参具有相同类型的其他 Bean 自动装配到 Bean 的对应构造器入参中
4. autodetect: 自动判断, 如果能够 byType 自动装配就 byType, 如果不能就 byName

### byName

只要字段名和 bean 的名称相同, 就会自动注入。

```xml
<bean id="role" class="demo.Role" />
<!-- 把beanName为"role"的bean自动注入到user1中 -->
<bean id="user1" class="demo.User" autowire="byName" />
```

### byType

只要字段类型和 bean 的类型相同, 就会自动注入。

```xml
<bean id="role" class="demo.Role" />
<!-- 把类型为"demo.Role"的bean自动注入到user1中 -->
<bean id="user1" class="demo.User" autowire="byType" />
```

### constructor

只要构造方法的参数类型和 bean 的类型相同, 就会自动注入。

```xml
<bean id="role" class="demo.Role" />
<!-- 如果User类中有构造方法 public User(Role role); -->
<!-- 就会把类型为"demo.Role"的bean自动注入到user1中 -->
<bean id="user1" class="demo.User" autowire="constructor" />
```

### autodetect

Spring3.0 之后已经废弃。

### 统一配置

在 eans 上设置属性 default-autowire, 为所有 bean 指定一种自动装配策略。

```xml
<beans default-autowire="byType">
</beans>
```

## 通过注解自动装配

Spring 支持几种不同的自动装配的注解:

1. @Autowired 注解
2. @Inject 注解
3. @Resource 注解

### Autowired

```java
public class User{
    @Autowired
    private Role role;
}
public class Role {}
```

Autowired 自动装配过程:

1. 首先查找与字段相同类型的 bean
2. 如果同一个类型匹配到多个实例, 就查找与字段同名的 bean
3. 如果也没有与字段同名的 bean, 就会查找有没有设置@Primary 注解的 bean
4. 如果也没有, 就查找有没有设置@Priority 注解的 bean, 找到优先级最高的 bean
5. 都没有, 抛出 NoUniqueBeanDefinitionException 异常

```java
@Service("userService1")
public class UserServiceImpl implements UserService {}
@Service("userService2")
public class UserServiceImpl implements UserService {}

@Controller
public class UserController {
    // 会注入userService1
    @Autowired
    private UserService userService1;
}
```
