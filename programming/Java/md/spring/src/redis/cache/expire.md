# 过期策略

Redis 的过期策略是指 Redis 如何处理达到了过期时间的 key。Redis 会配合使用惰性删除和定时删除两种策略。

## 惰性删除

惰性删除(Lazy Deletion): 当客户端访问一个 key 时, Redis 会先检查这个 key 是否过期, 如果已经过期, Redis 会先删除该 key, 然后返回一个表示 key 不存在或者操作无法执行的错误信息。

### 优点

- 惰性删除避免了定期扫描整个数据库来查找过期 key, 从而减少了 CPU 的负载和能耗。这种方式只在 key 被访问时才进行检查, 因此对于不常被查询的 key, Redis 不需要花费额外的资源去检查和删除它们
- 由于 Redis 不需要主动去扫描和管理过期 key, 它可以将更多的时间用于处理客户端的请求, 从而提高了响应时间

### 缺点

- 惰性删除可能导致过期数据在内存中停留更长时间, 尤其是那些不经常被访问的 key。这可能会占用更多的内存资源, 直到这些 key 最终被访问并删除
- 虽然惰性删除可以提高响应时间, 但如果大量过期 key 在同一时间被访问, 可能会导致短暂的性能峰值, 因为 Redis 需要在这些时刻处理删除操作

## 定时删除

定时删除(Timed Deletion): Redis 也会周期性地扫描一部分 key, 查找并删除已经过期的 key。这个操作是定时进行的, 可以在配置文件中设置扫描的频率和每个周期扫描的 key 的数量。这种方式有助于维护数据库的清洁, 确保过期的 key 能够被及时删除。

### FAST 模式

FAST 模式是一种更为积极的数据过期删除策略。在这种模式下, Redis 会以较高的频率检查并删除过期的 key。这种模式的特点是执行频率不固定, 但两次执行之间的间隔不会超过 2 毫秒, 且每次执行的总时间不会超过 1 毫秒。FAST 模式的优点是可以通过高频率的检查来及时清理过期的 key, 从而减少内存的使用。然而, 这种模式的缺点是可能会对 CPU 造成一定的负担, 尤其是当过期 key 数量较多时。

### SLOW 模式

SLOW 模式则是一种更为宽松的数据过期删除策略。在 SLOW 模式下, Redis 会以较低的频率(执行频率默认为 10hz, 每次不超过 25ms)执行过期 key 的检查和清理。SLOW 模式的特点是执行频率可以通过配置文件 redis.conf 来调整。这种模式的优点是对 CPU 的影响较小, 因为它不会频繁地执行删除操作。然而, 这种模式的缺点是可能会导致过期 key 在内存中停留较长时间, 从而占用更多的内存资源。

### 优点: 

- 相比于惰性删除, 定时删除可以减少因为过期 key 未被访问而长时间占用内存的情况

### 缺点: 

- 定时删除需要定期扫描数据库, 这可能会导致额外的 CPU 负载, 尤其是在数据量大的情况下
- 定时删除的效果很大程度上取决于扫描频率的配置。如果设置得太低, 可能会导致过期 key 在内存中停留过久；如果设置得太高, 可能会增加 CPU 负载和性能波动
