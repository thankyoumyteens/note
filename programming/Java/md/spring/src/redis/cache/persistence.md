# 持久化

Redis 的持久化是指将内存中的数据保存到磁盘上。由于 Redis 是一个基于内存的数据存储系统，内存中的数据在服务器重启或崩溃后会丢失。为了解决这个问题，Redis 提供了几种持久化机制，使得数据可以在这些情况下得到恢复。

## RDB

RDB(Redis Database): 这种持久化方式是通过创建 Redis 数据的快照来实现的。Redis 可以配置在特定的时间间隔内自动保存快照。当 Redis 需要保存快照时，它会将当前内存中的数据集写入到一个 RDB 文件中。这种方式的优点是恢复速度快，且对性能的影响较小，因为写入操作是批量进行的。但是，如果在最后一次成功保存快照之后有数据变更，而这些变更在下一次快照保存之前发生故障，那么这些变更将会丢失。

RDB 有两种触发方式，分别是自动触发和手动触发。

手动触发 RDB 的命令有两种：

1. save: 该命令会阻塞当前 Redis 服务器，执行 save 命令期间，Redis 不能处理其他命令，直到快照完成为止
2. bgsave: 执行该命令时，Redis 会开启一个子进程在后台进行快照操作

自动触发 RDB 需要修改 redis.conf 文件:

```shell
# 表示 60 秒内如果至少有 10000 个 key 的值变化，则执行 bgsave
save 60 10000
# 当后台保存进程失败时，是否停止主服务器的写操作, 默认是yes
stop-writes-on-bgsave-error yes
# 是否对RDB文件进行压缩。压缩可以减小RDB文件的大小，但会增加CPU的占用, 默认是yes
rdbcompression yes
# 是否对RDB文件进行校验和检查。这有助于在加载RDB文件时检测数据损坏, 默认是yes
rdbchecksum yes
```
