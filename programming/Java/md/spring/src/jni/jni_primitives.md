# 访问基本数据类型

1. 创建 `src/main/java/org/example/jnidemo/TestJNIPrimitive.java` 文件:

```java
package org.example.jnidemo;

public class TestJNIPrimitive {
    static {
        System.loadLibrary("myjni");
    }

    // 计算平均数
    private native double average(int n1, int n2);

    public static void main(String[] args) {
        System.out.println("In Java, the average is " + new TestJNIPrimitive().average(3, 2));
    }
}
```

2. 编译并生成头文件:

```sh
cd src/main/java/org/example/jnidemo
# . 表示在当前目录下生成, 可以指定其它目录
javac -h . TestJNIPrimitive.java
```

目录下会新增 `org_example_jnidemo_TestJNIPrimitive.h` 文件

头文件内容如下:

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class org_example_jnidemo_TestJNIPrimitive */

#ifndef _Included_org_example_jnidemo_TestJNIPrimitive
#define _Included_org_example_jnidemo_TestJNIPrimitive
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     org_example_jnidemo_TestJNIPrimitive
 * Method:    average
 * Signature: (II)D
 */
JNIEXPORT jdouble JNICALL Java_org_example_jnidemo_TestJNIPrimitive_average
  (JNIEnv *, jobject, jint, jint);

#ifdef __cplusplus
}
#endif
#endif
```

3. 创建 `src/main/java/org/example/jnidemo/TestJNIPrimitive.cpp` 文件:

```cpp
#include <jni.h>
#include <iostream>
#include "org_example_jnidemo_TestJNIPrimitive.h"
using namespace std;

JNIEXPORT jdouble JNICALL Java_org_example_jnidemo_TestJNIPrimitive_average
          (JNIEnv *env, jobject obj, jint n1, jint n2) {
   jdouble result;
   cout << "In C++, the numbers are " << n1 << " and " << n2 << endl;
   result = ((jdouble)n1 + n2) / 2.0;
   // jint is mapped to int, jdouble is mapped to double
   return result;
}
```

4. 编译 c++ 代码:

```sh
g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -dynamiclib -o libmyjni.dylib TestJNIPrimitive.cpp
```

5. 运行 java

```sh
cd ../../../
java -Djava.library.path=org/example/jnidemo  org.example.jnidemo.TestJNIPrimitive
```
