# 基本类型数组传参

1. 创建 `src/main/java/org/example/jnidemo/TestJNIPrimitiveArray.java` 文件:

```java
package org.example.jnidemo;

public class TestJNIPrimitiveArray {
    static {
        System.loadLibrary("myjni"); // myjni.dll (Windows) or libmyjni.so (Unixes)
    }

    // Declare a native method sumAndAverage() that receives an int[] and
    //  return a double[2] array with [0] as sum and [1] as average
    private native double[] sumAndAverage(int[] numbers);

    // Test Driver
    public static void main(String[] args) {
        int[] numbers = {22, 33, 33};
        double[] results = new TestJNIPrimitiveArray().sumAndAverage(numbers);
        System.out.println("In Java, the sum is " + results[0]);
        System.out.println("In Java, the average is " + results[1]);
    }
}
```

2. 编译并生成头文件:

```sh
cd src/main/java/org/example/jnidemo
# . 表示在当前目录下生成, 可以指定其它目录
javac -h . TestJNIPrimitiveArray.java
```

目录下会新增 `org_example_jnidemo_TestJNIPrimitiveArray.h` 文件

头文件内容如下:

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class org_example_jnidemo_TestJNIPrimitiveArray */

#ifndef _Included_org_example_jnidemo_TestJNIPrimitiveArray
#define _Included_org_example_jnidemo_TestJNIPrimitiveArray
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     org_example_jnidemo_TestJNIPrimitiveArray
 * Method:    sumAndAverage
 * Signature: ([I)[D
 */
JNIEXPORT jdoubleArray JNICALL Java_org_example_jnidemo_TestJNIPrimitiveArray_sumAndAverage
  (JNIEnv *, jobject, jintArray);

#ifdef __cplusplus
}
#endif
#endif
```

3. 创建 `src/main/java/org/example/jnidemo/TestJNIPrimitiveArray.cpp` 文件:

```cpp
#include <jni.h>
#include <iostream>
#include "org_example_jnidemo_TestJNIPrimitiveArray.h"

JNIEXPORT jdoubleArray JNICALL Java_org_example_jnidemo_TestJNIPrimitiveArray_sumAndAverage
          (JNIEnv *env, jobject thisObj, jintArray inJNIArray) {
   // Step 1: Convert the incoming JNI jintarray to C's jint[]
   jint *inCArray = env->GetIntArrayElements(inJNIArray, NULL);
   if (NULL == inCArray) return NULL;
   jsize length = env->GetArrayLength(inJNIArray);

   // Step 2: Perform its intended operations
   jint sum = 0;
   int i;
   for (i = 0; i < length; i++) {
      sum += inCArray[i];
   }
   jdouble average = (jdouble) sum / length;
   env->ReleaseIntArrayElements(inJNIArray, inCArray, 0); // release resources

   jdouble outCArray[] = {sum, average};

   // Step 3: Convert the C's Native jdouble[] to JNI jdoublearray, and return
   jdoubleArray outJNIArray = env->NewDoubleArray(2);  // allocate
   if (NULL == outJNIArray) return NULL;
   env->SetDoubleArrayRegion(outJNIArray, 0 , 2, outCArray);  // copy
   return outJNIArray;
}
```

4. 编译 c++ 代码:

```sh
g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -dynamiclib -o libmyjni.dylib TestJNIPrimitiveArray.cpp
```

5. 运行 java

```sh
cd ../../../
java -Djava.library.path=org/example/jnidemo  org.example.jnidemo.TestJNIPrimitiveArray
```
