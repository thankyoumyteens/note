# JNI 调用 c 代码

1. 创建 `src/main/java/org/example/jnidemo/HelloJNI.java` 文件:

```java
package org.example.jnidemo;

public class HelloJNI {
    static {
        // 加载使用c代码编译成的函数库
        // Windows下是 hello.dll
        // Linux下是 libhello.so
        // MacOS下是 libhello.dylib
        System.loadLibrary("hello");
    }

    // 定义native方法, sayHello方法使用c实现
    private native void sayHello();

    // 测试
    public static void main(String[] args) {
        // 调用native方法
        new HelloJNI().sayHello();
    }
}
```

2. 编译并生成头文件:

```sh
cd src/main/java/org/example/jnidemo
# . 表示在当前目录下生成, 可以指定其它目录
javac -h . HelloJNI.java
```

目录下会新增 `org_example_jnidemo_HelloJNI.h` 文件

头文件内容如下:

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class org_example_jnidemo_HelloJNI */

#ifndef _Included_org_example_jnidemo_HelloJNI
#define _Included_org_example_jnidemo_HelloJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     org_example_jnidemo_HelloJNI
 * Method:    sayHello
 * Signature: ()V
 * 自动生成的函数名格式:
 *   Java_{package_and_classname}_{function_name}(JNI_arguments)
 * JNIEnv * : JNI上下文
 * jobject : 取决于sayHello方法在java中的定义, 静态方法就是类对象, 实例方法就是this
 */
JNIEXPORT void JNICALL Java_org_example_jnidemo_HelloJNI_sayHello(JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
```

3. 创建 `src/main/java/org/example/jnidemo/HelloJNI.c` 文件:

```c
#include <jni.h>
#include <stdio.h>
#include "org_example_jnidemo_HelloJNI.h"

// 必须和org_example_jnidemo_HelloJNI.h中的函数定义一致
JNIEXPORT void JNICALL Java_org_example_jnidemo_HelloJNI_sayHello(JNIEnv *env, jobject thisObj) {
   printf("Hello World!\n");
   return;
}
```

4. 编译 c 代码:

```sh
gcc -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -dynamiclib -o libhello.dylib HelloJNI.c
```

5. 运行 java

```sh
cd ../../../
java -Djava.library.path=org/example/jnidemo  org.example.jnidemo.HelloJNI
```
