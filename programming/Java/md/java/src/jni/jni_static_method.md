# 访问类的静态方法

1. 创建 `src/main/java/org/example/jnidemo/TestJNICallBackStaticMethod.java` 文件:

```java
package org.example.jnidemo;

public class TestJNICallBackStaticMethod {
    static {
        System.loadLibrary("myjni");
    }

    // 在nativeMethod中会调用下面的callback方法
    private native void nativeMethod();

    private static String callbackStatic() {
      return "From static Java method";
   }

    public static void main(String[] args) {
        new TestJNICallBackStaticMethod().nativeMethod();
    }
}
```

2. 编译并生成头文件:

```sh
cd src/main/java/org/example/jnidemo
# . 表示在当前目录下生成, 可以指定其它目录
javac -h . TestJNICallBackStaticMethod.java
```

目录下会新增 `org_example_jnidemo_TestJNICallBackStaticMethod.h` 文件

头文件内容如下:

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class org_example_jnidemo_TestJNICallBackStaticMethod */

#ifndef _Included_org_example_jnidemo_TestJNICallBackStaticMethod
#define _Included_org_example_jnidemo_TestJNICallBackStaticMethod
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     org_example_jnidemo_TestJNICallBackStaticMethod
 * Method:    nativeMethod
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_org_example_jnidemo_TestJNICallBackStaticMethod_nativeMethod
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
```

3. 创建 `src/main/java/org/example/jnidemo/TestJNICallBackStaticMethod.cpp` 文件:

```cpp
#include <jni.h>
#include <stdio.h>
#include "org_example_jnidemo_TestJNICallBackStaticMethod.h"

JNIEXPORT void JNICALL Java_org_example_jnidemo_TestJNICallBackStaticMethod_nativeMethod
          (JNIEnv *env, jobject thisObj) {

   // 获取对象的Class
   jclass thisClass = env->GetObjectClass(thisObj);

   // 获取String callbackStatic()方法的id
   jmethodID midCallBackStatic = env->GetStaticMethodID(thisClass,
                                 "callbackStatic", "()Ljava/lang/String;");
   if (NULL == midCallBackStatic) return;
   // 执行callbackStatic方法
   jstring resultJNIStr = (jstring) env->CallStaticObjectMethod(thisClass, midCallBackStatic);
   // 把java的String转成c++的字符串
   const char *resultCStr = env->GetStringUTFChars(resultJNIStr, NULL);
   if (NULL == resultCStr) return;
   printf("In C, the returned string is %s\n", resultCStr);
   // 释放字符串资源
   env->ReleaseStringUTFChars(resultJNIStr, resultCStr);
}
```

4. 编译 c++ 代码:

```sh
g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -dynamiclib -o libmyjni.dylib TestJNICallBackStaticMethod.cpp
```

5. 运行 java

```sh
cd ../../../
java -Djava.library.path=org/example/jnidemo  org.example.jnidemo.TestJNICallBackStaticMethod
```
