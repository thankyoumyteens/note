# 访问字符串

1. 创建 `src/main/java/org/example/jnidemo/TestJNIString.java` 文件:

```java
package org.example.jnidemo;

public class TestJNIString {
    static {
        System.loadLibrary("myjni");
    }

    private native String sayHello(String msg);

    public static void main(String[] args) {
        String result = new TestJNIString().sayHello("Hello from Java");
        System.out.println("In Java, the returned string is: " + result);
    }
}
```

2. 编译并生成头文件:

```sh
cd src/main/java/org/example/jnidemo
# . 表示在当前目录下生成, 可以指定其它目录
javac -h . TestJNIString.java
```

目录下会新增 `org_example_jnidemo_TestJNIString.h` 文件

头文件内容如下:

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class org_example_jnidemo_TestJNIString */

#ifndef _Included_org_example_jnidemo_TestJNIString
#define _Included_org_example_jnidemo_TestJNIString
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     org_example_jnidemo_TestJNIString
 * Method:    sayHello
 * Signature: (Ljava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_org_example_jnidemo_TestJNIString_sayHello
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif
```

3. 创建 `src/main/java/org/example/jnidemo/TestJNIString.cpp` 文件:

```cpp
#include <jni.h>
#include <iostream>
#include <string>
#include "org_example_jnidemo_TestJNIString.h"
using namespace std;

JNIEXPORT jstring JNICALL Java_org_example_jnidemo_TestJNIString_sayHello(JNIEnv *env, jobject thisObj, jstring inJNIStr) {
   // Step 1: Convert the JNI String (jstring) into C-String (char*)
   const char *inCStr = env->GetStringUTFChars(inJNIStr, NULL);
   if (NULL == inCStr) return NULL;

   // Step 2: Perform its intended operations
   cout << "In C++, the received string is: " << inCStr << endl;
   env->ReleaseStringUTFChars(inJNIStr, inCStr);  // release resources

   // Prompt user for a C++ string
   string outCppStr;
   cout << "Enter a String: ";
   cin >> outCppStr;

   // Step 3: Convert the C++ string to C-string, then to JNI String (jstring) and return
   return env->NewStringUTF(outCppStr.c_str());
}
```

4. 编译 c++ 代码:

```sh
g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -dynamiclib -o libmyjni.dylib TestJNIString.cpp
```

5. 运行 java

```sh
cd ../../../
java -Djava.library.path=org/example/jnidemo  org.example.jnidemo.TestJNIString
```
