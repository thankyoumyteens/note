# 访问类变量

1. 创建 `src/main/java/org/example/jnidemo/TestJNIStaticVariable.java` 文件:

```java
package org.example.jnidemo;

public class TestJNIStaticVariable {
    static {
        System.loadLibrary("myjni");
    }

    // Static variables
    private static double number = 55.66;

    // Declare a native method that modifies the static variable
    private native void modifyStaticVariable();

    // Test Driver
    public static void main(String[] args) {
        TestJNIStaticVariable test = new TestJNIStaticVariable();
        test.modifyStaticVariable();
        System.out.println("In Java, the double is " + number);
    }
}
```

2. 编译并生成头文件:

```sh
cd src/main/java/org/example/jnidemo
# . 表示在当前目录下生成, 可以指定其它目录
javac -h . TestJNIStaticVariable.java
```

目录下会新增 `org_example_jnidemo_TestJNIStaticVariable.h` 文件

头文件内容如下:

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class org_example_jnidemo_TestJNIStaticVariable */

#ifndef _Included_org_example_jnidemo_TestJNIStaticVariable
#define _Included_org_example_jnidemo_TestJNIStaticVariable
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     org_example_jnidemo_TestJNIStaticVariable
 * Method:    modifyStaticVariable
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_org_example_jnidemo_TestJNIStaticVariable_modifyStaticVariable
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

```

3. 创建 `src/main/java/org/example/jnidemo/TestJNIStaticVariable.cpp` 文件:

```cpp
#include <jni.h>
#include <stdio.h>
#include "org_example_jnidemo_TestJNIStaticVariable.h"

JNIEXPORT void JNICALL Java_org_example_jnidemo_TestJNIStaticVariable_modifyStaticVariable
          (JNIEnv *env, jobject thisObj) {
   // 获取对象的Class
   jclass thisClass = env->GetObjectClass(thisObj);

   // 获取number字段的id
   jfieldID fidNumber = env->GetStaticFieldID(thisClass, "number", "D");
   if (NULL == fidNumber) return;

   // 根据字段id从对象中获取字段的值
   jdouble number = env->GetStaticDoubleField(thisClass, fidNumber);
   printf("In C, the double is %f\n", number);

   // 修改字段的值
   number = 77.88;
   // 根据字段id修改对象中字段的值
   env->SetStaticDoubleField(thisClass, fidNumber, number);

}
```

4. 编译 c++ 代码:

```sh
g++ -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin" -dynamiclib -o libmyjni.dylib TestJNIStaticVariable.cpp
```

5. 运行 java

```sh
cd ../../../
java -Djava.library.path=org/example/jnidemo  org.example.jnidemo.TestJNIStaticVariable
```
