# IO 多路复用(I/O Multiplexing)

非阻塞 IO 的缺点是每次发起系统调用，只能检查一个文件描述符是否就绪。当文件描述符很多时，系统调用的成本很高。

IO 多路复用可以通过一次系统调用，检查多个文件描述符的状态。这是 IO 多路复用的主要优点，相比于非阻塞 IO，在文件描述符较多的场景下，避免了频繁的用户态和内核态的切换，减少了系统调用的开销。

在 linux 中，有 3 种系统调用可以让内核监测文件描述符，分别是: select, poll, epoll。

select, poll, epoll 使得进程可以在有数据时再发起真正的 IO 操作, 但是 select, poll, epoll 在等待 IO 事件发生时仍然处于阻塞状态。

以 socket 的 recvfrom 系统调用为例, 流程如下:

![](../../img/3.jpg)

Java 的 NIO 技术, 使用的就是 IO 多路复用模型。在 Linux 系统上使用的是 epoll 系统调用。

IO 多路复用并不是真正异步的 IO, 不管是 select, poll 还是 epoll, 都会导致进程阻塞。而发起真正的 IO 操作时(比如 recvfrom)，进程也会阻塞。IO 多路复用模型与一个线程维护一个连接的阻塞 IO 模式相比, 最大优势在于, 一个线程可以同时处理成千上万个连接, 系统不必创建大量的线程, 也不必维护这些线程, 从而大大减小了系统的开销。

## select
