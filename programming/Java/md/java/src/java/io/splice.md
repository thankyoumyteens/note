# splice 实现零拷贝

Linux 在 2.6.17 版本引入 splice 系统调用, splice 系统调用可以在内核空间的读缓冲区和 socket 缓冲区之间建立管道, 从而避免了两者之间的 CPU 拷贝操作。

基于 splice 系统调用的零拷贝方式, 整个拷贝过程会发生 2 次上下文切换, 2 次拷贝, 流程如下：

1. 用户进程通过 `splice()` 函数向内核发起系统调用, 上下文从用户态切换为内核态
2. CPU 利用 DMA 控制器将数据从主存或硬盘拷贝到内核的读缓冲区
3. CPU 在内核空间的读缓冲区和 socket 缓冲区之间建立管道
4. CPU 利用 DMA 控制器将数据从 socket 缓冲区拷贝到网卡
5. 上下文从内核态切换回用户态, splice 系统调用返回
