# 高性能设计

kafka 中实现高性能的设计:

1. 消息分区: 不受单台服务器限制, 可以处理更多数据
2. 顺序读写: 磁盘顺序读写, 提升读写效率
3. 页缓存: 把磁盘中的数据缓存到内存中, 把对磁盘的访问变成对内存的访问
4. 零拷贝: 减少上下文切换和数据拷贝
5. 消息压缩: 减少磁盘和网络 IO
6. 分批发送: 把消息打包分批发送, 减少网络开销

## 零拷贝

RocketMQ 选择了 mmap + write 这种零拷贝方式, 适用于业务级消息这种小块文件的数据持久化和传输；而 Kafka 采用的是 sendfile 这种零拷贝方式, 适用于系统日志消息这种高吞吐量的大块文件的数据持久化和传输。但是值得注意的一点是, Kafka 的索引文件使用的是 mmap + write 方式, 数据文件使用的是 sendfile 方式。
