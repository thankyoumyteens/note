# CAS

CAS(比较并交换, Compare-And-Swap)是一种常用于多线程编程中的原子操作。

CAS 操作包含三个主要的参数：内存位置(V)、预期原值(A)和新值(B)。执行 CAS 操作的基本步骤如下：

1. **比较**：首先，它会检查内存位置 V 中的值是否与预期原值 A 相等
2. **交换**：如果相等，那么处理器会自动将该位置值更新为新值 B
3. **返回**：如果更新成功，CAS 操作会返回 true。如果内存位置 V 中的值在检查和更新之间被其他线程改变，则更新失败，CAS 操作返回 false

CAS 操作是原子的，这意味着在任何时候，其他线程都不能看到中间状态。

在 Java 中，`java.util.concurrent.atomic`包提供了多种支持 CAS 操作的原子类，例如`AtomicInteger`、`AtomicLong`等。这些类利用底层硬件支持的 CAS 指令来保证操作的原子性。

## 悲观锁和乐观锁

- 悲观锁采用悲观思想处理数据, 在每次读取数据时都认为别人会修改数据, 所以每次在读写数据时都会上锁, 这样别人想读写这个数据时就会阻塞、等待直到拿到锁
- 乐观锁采用乐观的思想处理数据, 在每次读取数据时都认为别人不会修改该数据, 所以不会上锁, 但在更新时会判断在此期间别人有没有更新该数据, 通常采用在写时先读出当前版本号然后加锁的方法
