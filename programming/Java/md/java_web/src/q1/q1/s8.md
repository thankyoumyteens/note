# SpringCloud

## CAP 定理

- 一致性(Consistency): 指的是所有节点在同一时刻看到的数据是相同的。即, 一旦一个写操作被确认成功完成, 那么之后的所有节点的读操作都应该返回最新的值
- 可用性(Availability): 指的是每个请求无论是否最终成功都要得到响应。即, 每个操作都应该在有限的时间内得到回复, 即使这个回复是失败信息
- 分区容错性(Partition tolerance): 指的是即便一部分节点由于网络问题无法与其他节点通信时, 系统仍然能够继续运作

在实际应用中, 分布式系统一定是需要网络的, 而网络故障是不可避免的, 所以分区容错性是必须的。

- AP: 如果要保证系统可以持续对外提供服务, 那么就不能保证系统数据的强一致性
- CP: 如果要保证系统数据的强一致性, 就要放弃高可用性

## nacos 实现了 CAP 中的哪两个

Nacos 既可以实现 AP（可用性和分区容错性）模式，也可以实现 CP（一致性和分区容错性）模式，用户可以根据具体的业务场景选择合适的模式。

Nacos 默认采用 AP 模式，在集群环境下，即使部分节点出现故障或网络分区，客户端仍然可以从其他可用节点获取服务信息和配置信息。

可以通过修改 Nacos 配置文件中的 mode 参数将 Nacos 切换为 CP 模式。

## 什么是服务熔断？什么是服务降级

熔断机制是应对雪崩效应的一种微服务链路保护机制。当某个微服务不可用或者响应时间太长时，会进行服务降级，进而熔断该节点微服务的调用，快速返回“错误”的响应信息。当检测到该节点微服务调用响应正常后恢复调用链路。

服务降级，一般是从整体负荷考虑。就是当某个服务熔断之后，服务器将不再被调用，此时客户端可以自己准备一个本地的 fallback 回调，返回一个缺省值。这样做，虽然水平下降，但好歹可用，比直接挂掉强。

在 SpringCloud 框架里熔断机制通过 Hystrix 实现，Hystrix 会监控微服务间调用的状况，当失败的调用到一定阈值，缺省是 5 秒内调用 20 次，如果失败，就会启动熔断机制。

Hystrix 相关注解 @EnableHystrix：开启熔断 @HystrixCommand(fallbackMethod=”XXX”)：声明一个失败回滚处理函数 XXX，当被注解的方法执行超时（默认是 1000 毫秒），就会执行 fallback 函数，返回错误提示。

## Eureka 和 zookeeper 的区别
