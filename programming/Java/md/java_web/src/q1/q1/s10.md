# Redis

## Redis 持久化方式

- RDB 用数据集快照的方式半持久化模式记录 redis 数据库的所有键值对,在某个时间点将数据写入一个临时文件，持久化结束后，用这个临时文件替换上次持久化的文件，达到数据恢复
  - 优点：只有一个文件 dump.rdb ，方便持久化。容灾性好，一个文件可以保存到安全的磁盘。性能最大化，fork 子进程来完成写操作，让主进程继续处理命令，所以是 IO 最大化。使用单独子进程来进行持久化，主进程不会进行任何 IO 操作，保证了 Redis 的高性能。相对于数据集大时，比 AOF 的启动效率更高。
  - 缺点：数据安全性低。 RDB 是间隔一段时间进行持久化，如果持久化之间 Redis 发生故障，会发生数据丢失。所以这种方式更适合数据要求不严谨的时候
- AOF 指所有的命令行记录以 Redis 命令请求协议的格式完全持久化存储，保存为 AOF 文件
  - 优点：数据安全， AOF 持久化可以配置, 使每进行一次命令操作就记录到 AOF 文件中一次。通过 append 模式写文件，即使中途服务器宕机，可以通过 redis-check-aof 工具解决数据一致性问题。AOF 机制有 rewrite 模式, AOF 文件没被 rewrite 之前(文件过大时会对命令进行合并重写)，可以删除其中的某些命令(比如误操作的 flushall)
  - 缺点：AOF 文件比 RDB 文件大，且恢复速度慢。数据集大的时候，比 RDB 启动效率低。

## 排名功能要用 redis 的哪个数据类型

在实现排名功能时，Redis 中的有序集合（Sorted Set，也称为 ZSet）是最合适的数据类型

有序集合的特性:

- 成员唯一：有序集合中的每个成员都是唯一的，不会出现重复的成员
- 分数排序：每个成员都关联着一个分数（score），Redis 会根据这些分数对成员进行从小到大的排序。当分数相同时，会按照成员的字典序进行排序
- 高效操作：支持对成员的添加、删除、修改分数等操作，并且可以根据分数范围或排名范围快速获取成员

```sh
# 添加成员及分数
ZADD game_ranking 100 "player1" 200 "player2" 150 "player3"
# 获取玩家 "player2" 的排名
ZREVRANK game_ranking "player2"
# 获取排名范围内的成员, 获取排名前 3 的玩家
ZREVRANGE game_ranking 0 2 WITHSCORES
# 将玩家 "player1" 的分数增加 50
ZINCRBY game_ranking 50 "player1"
```
