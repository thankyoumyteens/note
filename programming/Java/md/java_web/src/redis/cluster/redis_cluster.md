# 分片集群

redis 主从可以保证高并发读, 哨兵可以保证高可用。但他们无法解决高并发写和海量数据存储的问题。

分片(sharding)集群可以解决上面的问题。

分片集群的特点:

- 集群中有多个 master, 每个 master 保存不同数据
- 每个 master 都可以有多个 slave 节点
- master 之间通过心跳检测机制, 监测彼此的健康状态
- 当有 master 掉线时, 可以重新选举主节点
- master 之间可以互相路由, 客户端请求时, 可以访问集群间的任意 master 节点, 就可以将请求转发到正确的节点上

## 哈希槽

分片集群中, 数据被分布在多个节点上, 这是通过哈希槽(hash slots)来实现的。

默认情况下, 集群一共有 16384 个哈希槽, 每个节点负责一部分哈希槽, 例如, 如果有三个节点, 则可能每个节点负责大约 5000 个哈希槽。当客户端尝试访问一个键时, Redis 集群会根据其键名通过 CRC16 哈希函数计算出一个哈希值, 然后对 16384 取模, 得到一个介于 0 到 16383 之间的整数, 这个整数就对应一个哈希槽, 然后将请求定向到负责该槽的节点, 即使客户端连接到了不负责该哈希槽的节点, 该节点会将请求重定向到正确的节点。
