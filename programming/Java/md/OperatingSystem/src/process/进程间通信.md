# 进程间通信

进程是分配系统资源的单位(包括内存地址空间)，因此各进程拥有的内存地址空间相互独立。为了保证安全，一个进程不能直接访问另一个进程的地址空间。但是进程之间的信息交换又是必须实现的，所以操作系统提供了一些进程间通信的方法。

## 共享内存

共享内存方式是允许两个或多个进程共享一个公共内存空间，这样进程之间就可以通过对共享内存的读写实现通信。共享内存并未提供同步机制，也就是说，在第一个进程结束对共享内存的写操作之前，并无自动机制可以阻止第二个进程开始对它进行读取，所以通常需要用其他的机制来同步对共享内存的访问，例如信号量。

共享内存的方式有两种：

1. 基于数据结构的共享：共享空间里只能放指定的数据结构(如数组)。这种共享方式速度慢、限制多，是一种低级通信方式
2. 基于存储区的共享：在内存中画出一块共享存储区，数据的形式、存放位置都由进程控制，而不是操作系统。这种共享方式速度更快，是一种高级通信方式

## 管道通信

管道本质上就是一个文件，前面的进程以写方式打开文件，后面的进程以读方式打开。这样前面写完后面读，就实现了通信。虽然是文件，但是管道本身并不占用磁盘或者其他外部存储的空间。在Linux的实现上，它占用的是内存空间，在Linux上的管道就是一个操作方式为文件的内存缓冲区。

管道通信的特点：

1. 管道采用半双工通信，某一时间段内只能实现单向的传输。如果要实现双向同时通信，则需要设置两个管道
2. 各进程要互斥地访问管道
3. 数据以字符流的形式写入管道，当管道写满时，写进程将被阻塞，等待读进程将数据取走。当读进程将数据全部取走后，管道变空，此时读进程将被阻塞
4. 如果没写满，就不允许读。如果没读空，就不允许写
5. 数据一旦被读出，就从管道中被抛弃，这就意味着读进程最多只能有一个，否则可能会有读错数据的情况

## 消息队列

进程间的数据交换以格式化的消息为单位。进程通过操作系统提供的发送消息和接收消息两个原语进行数据交换。

消息由消息头和消息体组成。消息头包括：发送进程ID、接受进程ID、消息类型、消息长度等格式化的信息。消息体是实际的数据。

消息传递的方式：

1. 直接通信方式：消息直接挂到接收进程的消息缓冲队列上
2. 间接通信方式：消息的发送方将消息发送到消息队列，接收方从消息队列中提取消息
