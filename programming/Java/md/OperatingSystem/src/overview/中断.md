# 中断

中断是指在操作系统运行过程中，硬件或软件发生了某些特定事件或异常情况，需要打断正在执行的程序，转而去执行另外的程序或处理异常情况。中断是操作系统内核夺回CPU使用权的唯一途径。

## 内部中断

内部中断是由CPU内部产生的中断，如算术溢出、陷入指令等。这种中断通常是由程序错误或CPU硬件故障引起的异常情况，需要操作系统及时处理，以避免系统崩溃或数据丢失。

陷入指令(Trap Instruction)是一种特殊的指令，用于在程序中主动触发中断或异常。当执行到陷入指令时，CPU会暂停当前程序的执行，并转而执行由陷入指令所指定的中断处理程序或异常处理程序。陷入指令通常用于实现系统调用。

## 外部中断

外部中断是由外部设备或信号触发的中断，如硬件中断、时钟中断等。这种中断通常是由外部设备发出的请求或信号，需要操作系统及时响应和处理，以保证系统的正常运行和稳定性。

## 中断的执行过程

1. 中断请求：外部设备或内部事件发生时，会向CPU发送中断请求信号，通知操作系统有中断事件发生
2. 中断处理程序：CPU接收到中断请求后，会立即暂停当前正在执行的程序，并保存当前程序的上下文信息，包括程序计数器、寄存器状态等。然后根据中断类型去中断向量表中找到对应的中断向量，并跳转到中断向量所指向的中断处理程序
3. 中断处理：中断处理程序会根据中断类型进行相应的处理，可能包括读取外部设备数据、处理异常情况、执行特定操作等。处理完成后，可以将处理结果返回给原来的程序
4. 恢复现场：中断处理程序执行完毕后，操作系统会恢复原来程序的上下文信息，包括程序计数器、寄存器状态等，以便原来的程序可以继续执行
5. 继续执行：恢复现场后，操作系统会将控制权返回给原来的程序，使其从中断发生的地方继续执行

中断向量表(Interrupt Vector Table)通常是一个数组或表格，其中存储着中断向量(Interrupt Vector)。中断向量可以是一个整数值，也可以是一个指向中断处理程序的入口地址，每个中断类型都有一个唯一的中断向量，通过中断向量表可以根据中断类型找到对应的中断处理程序。
