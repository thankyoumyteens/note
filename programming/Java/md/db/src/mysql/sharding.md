# 分库分表

分库分表的时机:

1. 单表的数据量达到 1000 万或者 20GB
2. 优化已经无法解决性能问题(主从读写分离, sql 优化等)
3. I/O 瓶颈, 用户连接数太多

分库分表的方法:

1. 垂直分库: 以表为依据, 根据业务将不同的表拆分到不同的库中。比如: 一个微服务对应一个库
2. 垂直分表: 以字段为依, 根据字段属性不同把字段拆分到不同的表中
   - 把不常用的字段单独放在一张表中(冷热数据分离)
   - 把 text, blob 等大字段拆出来放在附表中
3. 水平分库: 把一个库的数据拆分到多个库中。比如: 节点 1 保存 id 为 1 到 100 万的数据, 节点 2 保存 id 为 100 万到 200 万的数据
4. 水平分表: 把一个表的数据拆分到多个表中(可以在同一个库)

分库分表带来的问题:

1. 分布式事务
2. 跨节点分页, 排序
3. 跨节点多表联查
4. 主键重复

使用中间件可以解决上面的问题。

常用的分库分表中间件:

- sharding-sphere
- mycat
