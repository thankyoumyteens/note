# 处理普通对象

普通对象的元数据指针会指向 InstanceKlass 类型的 klass。

> jdk8u60-master\hotspot\src\share\vm\oops\instanceKlass.cpp

```cpp
#if INCLUDE_ALL_GCS
#define InstanceKlass_OOP_OOP_ITERATE_BACKWARDS_DEFN(OopClosureType, nv_suffix) \
                                                                                \
int InstanceKlass::oop_oop_iterate_backwards##nv_suffix(oop obj,                \
                                              OopClosureType* closure) {        \
  SpecializationStats::record_iterate_call##nv_suffix(SpecializationStats::ik); \
                                                                                \
  assert_should_ignore_metadata(closure, nv_suffix);                            \
                                                                                \
  InstanceKlass_OOP_MAP_REVERSE_ITERATE(                                        \
    obj,                                                                        \
    SpecializationStats::record_do_oop_call##nv_suffix(SpecializationStats::ik);\
    (closure)->do_oop##nv_suffix(p),                                            \
    assert_is_in_closed_subset)                                                 \
   return size_helper();                                                        \
}
#endif // INCLUDE_ALL_GCS
```

> jdk8u60-master\hotspot\src\share\vm\gc_implementation\g1\g1OopClosures.inline.hpp

```cpp
// 处理这个对象的每一个字段
template <class T>
inline void G1ParScanClosure::do_oop_nv(T* p) {
  T heap_oop = oopDesc::load_heap_oop(p);

  if (!oopDesc::is_null(heap_oop)) {
    // 如果使用了压缩指针, 会解析压缩指针, 否则直接返回传入的参数
    oop obj = oopDesc::decode_heap_oop_not_null(heap_oop);
    const InCSetState state = _g1->in_cset_state(obj);
    if (state.is_in_cset()) {
      // 如果field指向的对象在CSet中, 放入队列, 准备后续复制
      Prefetch::write(obj->mark_addr(), 0);
      Prefetch::read(obj->mark_addr(), (HeapWordSize*2));
      _par_scan_state->push_on_queue(p);
    } else {
      if (state.is_humongous()) {
        _g1->set_humongous_is_live(obj);
      }
      // 如果不在CSet中, 仅仅只需要在后面重构RSet, 保持引用关系
      _par_scan_state->update_rs(_from, p, _worker_id);
    }
  }
}
```
