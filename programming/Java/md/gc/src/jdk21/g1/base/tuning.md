# Garbage-First 垃圾回收器调优

本节描述了如何在 G1 垃圾回收器（G1 GC）不符合您的要求时调整其行为。

## 推荐设置

一般的建议是使用 G1 的默认设置，如果需要，可以指定不同的停顿时间目标, 或者通过设置 `-Xmx` 来指定最大 Java 堆大小。

G1 的默认设置与其他回收器有所不同。G1 在默认配置下的目标既不是最大化吞吐量，也不是最低延迟，而是以较高的吞吐量提供相对较小且均匀的停顿时间。然而，G1 用于增量回收堆空间和控制停顿时间的机制会在应用程序线程和空间回收效率方面产生一些开销。

如果你偏好高吞吐量，可以通过使用 `-XX:MaxGCPauseMillis` 放宽停顿时间目标，或者提供更大的堆。如果延迟是主要要求，则修改停顿时间目标。避免使用 `-Xmn`、`-XX:NewRatio` 等选项将新生代大小限制为特定值，因为新生代大小是 G1 满足停顿时间目标的主要手段。将新生代大小设置为单一值会覆盖并实际上禁用停顿时间控制。

## 从其它回收器迁移到 G1

通常，从其他回收器（特别是并发标记清除回收器）切换到 G1 时，首先应移除所有影响垃圾回收的选项，仅设置停顿时间目标和使用 `-Xmx` 设置总体堆大小，必要时可以使用 `-Xms`。

许多对其他回收器用于以某种特定方式响应的有用的选项，对 G1 要么完全没有效果，要么甚至会降低吞吐量和满足停顿时间目标的可能性。一个例子是设置新生代大小，这会完全阻止 G1 调整新生代大小以满足停顿时间目标。

## 提高 G1 性能

G1 被设计为在不需要指定额外选项的情况下提供良好的整体性能。然而，有时候默认的启发式方法(heuristics)或默认配置可能会导致次优的结果。本节提供了一些关于诊断和改进这些情况的指南。本指南仅描述了在给定的应用程序中，G1 提供的改进垃圾回收器性能的方法，这些方法针对的是某个选定的度量指标。在具体情况下，应用程序级别的优化可能比尝试调整虚拟机以获得更好的性能更为有效，例如，通过减少长生命周期对象的使用来避免某些问题。

为了诊断，G1 提供了全面的日志记录。一个好的起点是使用 `-Xlog:gc*=debug` 选项，然后根据需要细化输出。日志提供了在停顿期间及之外关于垃圾回收活动的详细概览，包括回收的类型以及在各个停顿阶段所花费时间的细分。

以下小节探讨了一些常见的性能问题。

## 观察 Full GC
