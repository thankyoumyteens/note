# ZIP 文件中的 Entry

多个文件在 ZIP 包中是分别存储的，每个文件都会生成一个 Entry。比如 `a.zip` 里有 `foo.txt`、`bar/`、`bar/baz.png`，这三个都是 Entry。

每个 Entry 由以下 3 部分组成：

1. 普通本地文件头(Local File Header): 每个文件对应一个
2. 实际的数据(Data): 文件实际数据，可能压缩，也可能未压缩
3. 数据描述符(Data Descriptor): 可选

```
[Local File Header 1][Data 1]
[Local File Header 2][Data 2][Data Descriptor 2]
[Local File Header 3][Data 3]
...
```

## Local File Header

| 偏移量(offset) | 长度(字节) | 描述                                                                                                               |
| -------------- | ---------- | ------------------------------------------------------------------------------------------------------------------ |
| 0              | 4          | Local File Header 签名，固定值: 0x04034b50                                                                         |
| 4              | 2          | 提取本文件需要的最低版本号                                                                                         |
| 6              | 2          | 标志位，如果第三个 bit 被设置了(0x08)，表示写入的时候不知道数据大小和 CRC-32，则该 Entry 包含 Data Descriptor 部分 |
| 8              | 2          | 压缩方法, 0 表示本 Entry 没有压缩                                                                                  |
| 10             | 2          | 文件最后修改时间                                                                                                   |
| 12             | 2          | 文件最后修改日期                                                                                                   |
| 14             | 4          | 文件压缩前的 CRC-32                                                                                                |
| 18             | 4          | 文件压缩后的大小                                                                                                   |
| 22             | 4          | 文件压缩前的大小                                                                                                   |
| 26             | 2          | 文件名长度, 不能超过 65535 字节                                                                                    |
| 28             | 2          | 扩展字段长度                                                                                                       |
| 30             | n          | 文件名                                                                                                             |
| 30 + n         | m          | 扩展字段                                                                                                           |

## Data Descriptor

如果 entry 的 Local File Header 的标志位第三个 bit 被设置了(0x08)，表示写入的时候不知道数据大小和 CRC-32，则该 entry 需要包含 Data Descriptor。

| 偏移量(offset) | 长度(字节) | 描述                        |
| -------------- | ---------- | --------------------------- |
| 0              | 4          | 签名，固定值：0x08074b50    |
| 4              | 4          | 文件压缩前的 CRC-32         |
| 8              | 4          | 文件压缩后的大小，单位 byte |
| 12             | 4          | 文件压缩前的大小，单位 byte |
