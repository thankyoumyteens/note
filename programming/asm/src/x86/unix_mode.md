# Unix 权限

在 UNIX 和类 UNIX 操作系统中, 文件权限是非常重要的概念, 用于控制不同用户对文件或目录的访问能力。UNIX 权限系统基于一个权限位模式, 通过这些位来确定哪些用户可以读、写或执行一个文件。

## 普通权限

UNIX 权限主要由三类用户组成: 

1. **所有者(Owner)**: 文件或目录的所有者用户。
2. **组用户(Group)**: 与文件或目录所有者属于同一用户组的用户。
3. **其他用户(Other)**: 既不是所有者也不是组用户的所有其他用户。

每个文件或目录都有一组权限, 包括读(r)、写(w)和执行(x): 

- **读(r)**: 允许用户读取文件内容或查看目录中的文件列表。
- **写(w)**: 允许用户修改文件内容或在目录中创建、删除文件。
- **执行(x)**: 允许用户执行文件(如果是一个可执行程序)或进入目录。

权限通常用一个三位的八进制数表示, 每一位分别对应所有者、组用户和其他用户的权限。每个位的值由以下数字表示: 

- 0: 没有权限
- 1: 只有执行权限(对于目录是进入目录的权限)
- 2: 只有写权限
- 3: 写和执行权限(2+1)
- 4: 只有读权限
- 5: 读和执行权限(4+1)
- 6: 读和写权限(4+2)
- 7: 读、写和执行权限(4+2+1)

比如命令:

```sh
chmod 760 file.txt
```

表示文件所有者, 组用户,和其他用户都对 file.txt 文件具有读、写和执行的权限。

## 特殊权限

比如: 0777, 0777 最前面的 0, 是一个叫 suid 和 guid 和 sticky 的东西, 设置 suid 就是把 0 变为 4, 设置 guid 就把 0 变为 2, 设置 sticky 就是把 0 变为 1

第一位换成二进制后, 分成三部分:

- setuid 位, 如果该位为 1, 则表示设置 setuid 对应 4
- setgid 位, 如果该位为 1, 则表示设置 setgid 对应 2
- sticky 位, 如果该位为 1, 则表示设置 sticky 对应 1

setuid: 设置使文件在执行阶段具有文件所有者的权限. 典型的文件是 /usr/bin/passwd. 如果一般用户执行该文件, 则在执行过程中, 该文件可以获得 root 权限, 从而可以更改用户的密码

setgid: 该权限只对目录有效. 目录被设置该位后, 任何用户在此目录下创建的文件都具有和该目录所属的组相同的组

sticky bit: 该位可以理解为防删除位. 一个文件是否可以被某用户删除, 主要取决于该文件所属的组是否对该用户具有写权限.
如果没有写权限, 则这个目录下的所有文件都不能被删除, 同时也不能添加新的文件. 如果希望用户能够添加文件但同时不能删除文件,
则可以对文件使用 sticky bit 位. 设置该位后, 就算用户对目录具有写权限, 也不能删除该文件
