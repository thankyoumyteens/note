# 栈

计算机也有一个栈。计算机的栈处于内存地址的最顶端。

`push1` 指令将 32 位的值压入栈顶，该指令将一个寄存器值或内存值压入栈顶。`pop1` 将值从栈顶弹出。该指令将值从栈顶移除，并把这个值放入寄存器或其它存储位置。

当我们将值入栈时，栈顶会移动，以容纳新增加的值。不断将值入栈，栈会在内存中保持向下增长，直到达到存放代码或数据的地方。

栈寄存器 `%esp` 总是包含一个指向当前栈顶的指针，无论栈顶在何处。

每当用 `push1` 将数据入栈，`%esp` 所含的指针值都会减去 4，从而指向新的栈顶(栈是向下增长的)。想从栈中删除数据，只需使用 `pop1` 指令，该指令使 `%esp` 的值增加 4，并将先前栈顶的值放入你指定的寄存器。`push1` 和 `pop1` 都有一个操作数：对于 `pushl`，是要将其值人栈的寄存器；对于 `popl`，是要接收弹出栈数据的寄存器。

![](../img/stack.jpg)

如果想访问栈顶的值，在间接寻址方式中使用 `%esp` 即可。例如，以下代码将栈顶的内容移入 `%eax`：

```x86asm
movl (%esp), heax
```

如果只用以下指令：

```x86asm
movl %esp, %eax
```

那么 `%eax` 会保存指向栈顶的指针，而不是栈顶存放的值。将 `%esp` 置于括号中会使计算机遵循间接寻址方式，因此能获得 `%esp` 所含指针指向的值。

如果想访问栈顶的下一个值，使用指令：

```x86asm
movl 4(%esp), %eax
```

这条指令使用基址寻址方式，在寻找指针指向的值之前将 `%esp` 与 4 相加。
