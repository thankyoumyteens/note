# 密钥配送问题

加密是为了保证信息传输的安全，但密钥本身也是信息，密钥的传输安全又该如何保证呢？如果为密钥的传输再做一次加密，就陷入了死循环

# 非对称加密

对称加密中，只需要一个密钥，通信双方同时持有。而非对称加密需要4个密钥。通信双方各自准备一对公钥和私钥。其中公钥是公开的，由信息接受方提供给信息发送方。公钥用来对信息加密。私钥由信息接受方保留，用来解密。既然公钥是公开的，就不存在保密问题。也就是说非对称加密不存在密钥配送问题

公钥只能用做数据加密。公钥加密的数据，只能用对应的私钥才能解密。这是非对称加密的核心概念。

1. 消息接收方准备好公钥和私钥
2. 私钥接收方自己留存、公钥发布给消息发送方
3. 消息发送方使用接收方公钥对消息进行加密
4. 消息接收方用自己的私钥对消息解密

# 中间人攻击

中间人攻击指的是在通信双方的通道上，混入攻击者。他对接收方伪装成发送者，对放送放伪装成接收者。

他监听到双方发送公钥时，偷偷将消息篡改，发送自己的公钥给双方。然后自己则保存下来双方的公钥。

如此操作后，双方加密使用的都是攻击者的公钥，那么后面所有的通信，攻击者都可以在拦截后进行解密，并且篡改信息内容再用接收方公钥加密。而接收方拿到的将会是篡改后的信息。实际上，发送和接收方都是在和中间人通信。

要防范中间人，需要使用公钥证书。

# 证书的工作机制

1. 接收方生成密钥对 “接收方PublicKey” 和 “接收方PrivateKey”
2. 接收方保存好 “接收方PrivateKey”，将 “接收方PublicKey” 发给认证机构
3. 认证机构确认 “接收方PublicKey” 确实属于接收方，然后用自己的“ 机构PrivateKey” 对 “接收方PublicKey” 进行数字签名，生成证书
4. 发送方想要与接收方通信时，先从认证机构处获取到接收方公钥证书
5. 发送方用 “机构PublicKey” 验证证书上 “接收方PublicKey” 的签名，确保 “接收方PublicKey” 没有被篡改以及确实来自认证机构
6. 发送方用证书中的 “接收方PublicKey” 对信息进行加密，发给接收方
7. 接收方用自己的私钥 “接收方PrivateKey” 解密信息

# 如何验证认证机构的真伪

为了解决这个问题，认证机构引入了层级的概念。

每个认证机构的公钥都要由上一级认证机构颁发证书并提供验证。但这个链条不能无止境的延伸下去，一定会有终点。终点的认证机构是最高级别的认证机构，称为根CA(Certificate Authority)。根CA自己给自己颁发证书，自己对自己的公钥进行签名。

大部分用户的主机系统中都预设了顶级的可信认证机构，普通用户基本不用去考虑认证机构是否可信，除非是在系统上手动配置信任其它的认证机构
