# 常用

### 打印第100到200行的内容
```bash
sed -n '100,200p' /logs/info.log
```
### 打印有`/student/list`内容的行及其之后5行的的内容
```bash
sed -n '/\/student\/list/,+5p' /logs/info.log
```
### 把`sources.list`文件的所有`aaa`都替换成`bbb`
```bash
sudo sed -i "s@aaa@bbb@g" /etc/apt/sources.list
```
### 打印奇数行
```sh
sed -n '1~2p' test.file
```
### sed处理多个文件
```sh
# 用ls + awk组合生成脚本文件
# \047 表示单引号
ls | awk '{print "sed -n \047/^<p/w ../"$1"\047 "$1}' > sed.sh
```

# 语法格式

```
sed [选项] [命令] [输入文件]
```
# 执行流程

sed处理的文件既可以由标准输入重定向得到, 也可以当命令行参数传入, 命令行参数可以一次传入多个文件, sed会依次处理, 
处理时sed从文件或管道中读取一行, 处理一行, 输出一行；再读取一行, 再处理一行, 再输出一行……

# 模式空间
模式空间, 即为处理文件中一行内容的一个临时缓冲区。处理完一行之后就会把模式空间中的内容打印到标准输出, 然后自动清空缓存。

# 选项

模式空间: sed软件内部的一个临时缓存, 用于存放读取到的内容。

- `-n`, `--quiet`, `--silent` 取消自动打印模式空间
- `-r`, `--regexp-extended` 在脚本中使用扩展正则表达式, `\1`引用分组1, `\2`引用分组2
- `-i[扩展名]`, `--in-place[=扩展名]` 直接修改文件(如果指定扩展名就备份文件)
- `-b`, `--binary` 以二进制方式打开文件 (回车加换行不做特殊处理)
- `-s`, `--separate` 将输入文件视为各个独立的文件而不是一个长的连续输入

如果没有 `-e`, `--expression`, `-f` 或 `--file` 选项, 那么第一个非选项参数被视为sed脚本。
其他非选项参数被视为输入文件, 如果没有输入文件, 那么程序将从标准输入读取数据。

# 命令基础格式

```
[address1[,address2]][command][options]
```

## address

被address条件匹配的行会被执行command

- `3`表示第3行
- `3,5`表示3到5行
- `3,+2` 表示从3行开始向下2行
- `3~2` 表示处理3行开始的每2行, 即3,5,7...行, 2表示步长
- `/cat/`表示使用正则表达式匹配有内容`cat`的行
- `/cat/,5`表示从有内容`cat`的行到第5行
- `/cat/,+2` 表示从有内容`cat`的行开始向下2行
- `/^#define/` 表示以#define开头的行

## command

- `a` 新增, 此时options与command之间有一个空格, options为要增加的内容, 新增的内容为单独一行, 在当前行的下方, 如果需要增加多行, 行与行之间使用`\n`分割。
- `c` 取代, 此时options与command之间有一个空格, options为新的内容, 用新行取代旧行, 注意当指定行的范围时, 这些行将会被一起替换成一行, 而不是每行每行的替换。
- `i` 插入, 此时options与command之间有一个空格, options为要插入的内容, 插入的内容为单独一行, 在当前行的上方, 同样可以使用`\n`实现插入多行。
- `d` 删除, 不需要options。
- `p` 打印, 不需要options, 将当前模式空间的内容打印出来, 通常与参数 sed -n配合使用。
- `w` 存储选中的行到文件, 比如`sed '/cat/,+2w w.txt' sed.txt`, 当提供了文件名但是文件不存在的时候它会自动创建, 如果已经存在的话则会覆盖原文件的内容。
- `s` 替换, 最复杂的一个命令options格式为`/pattern/replacement/[flags]`

# command为s时的替换

命令格式
```
[address1[,address2]]s/pattern/replacement/[flags]
```
分隔符`/`可以换成`#`或者`@`

## flag

- `数字n`, 表示只更改该行匹配到的第n个
- `p` 只输出匹配到的行
- `w` 存储改变的行到文件, 比如`sed -n 's/i/I/w junk.txt' books.txt`, 当提供了文件名但是文件不存在的时候它会自动创建, 如果已经存在的话则会覆盖原文件的内容。
- `i` 匹配时忽略大小写
- `g` 表示该行出现的所有匹配内容都进行替换。如果不指定默认只对改行匹配到的第一个做更改。

# 使用扩展正则式的分组功能进行替换

```
sed -r -i 's/(PASS_MAX_DAYS)\s+([0-9]+)/\1 90/' /etc/login.defs
```

这条命令将/etc/login.defs文件的行`PASS_MAX_DAYS   99999`
替换为`PASS_MAX_DAYS 90`

- `(PASS_MAX_DAYS)`表示将PASS_MAX_DAYS放在分组1中
- `([0-9]+)`匹配任意多个数字, 放在分组2中
- `\1`引用分组1
- `\2`引用分组2
